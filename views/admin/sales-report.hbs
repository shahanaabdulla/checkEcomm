<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Sales Report</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css">

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
    }

    .sales-report-container {
      background-color: #ffffff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 1200px;
    }

    h1 {
      color: #007bff;
      text-align: center;
      margin-bottom: 20px;
    }

    .report-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .report-buttons button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .report-buttons button:hover {
      background-color: #0056b3;
    }

    #customReportForm {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    #customReportForm label,
    #customReportForm input,
    #customReportForm button {
      margin: 0 10px;
    }

    #customReportForm input,
    #customReportForm button {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #customReportForm button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #customReportForm button:hover {
      background-color: #0056b3;
    }

    #salesReport {
      margin-top: 20px;
    }

    #salesReport h2 {
      color: #007bff;
      text-align: center;
    }

    #salesReport p {
      text-align: center;
      font-size: 1.2em;
      color: #333;
    }

    table.dataTable {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    table.dataTable th,
    table.dataTable td {
      padding: 10px;
      text-align: left;
      border: 1px solid #ccc;
    }

    table.dataTable th {
      background-color: #f8f9fa;
    }

    table.dataTable tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .download-buttons {
      text-align: center;
      margin-top: 20px;
    }

    .download-buttons button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .download-buttons button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="sales-report-container">
    <h1>Sales Report</h1>
    <div class="report-buttons">
      <button onclick="fetchReport('daily')">Daily Report</button>
      <button onclick="fetchReport('weekly')">Weekly Report</button>
      <button onclick="fetchReport('monthly')">Monthly Report</button>
      <button onclick="fetchReport('yearly')">Yearly Report</button>
    </div>
    <form id="customReportForm">
      <label for="startDate">Start Date:</label>
      <input type="date" id="startDate" name="startDate" required>
      <label for="endDate">End Date:</label>
      <input type="date" id="endDate" name="endDate" required>
      <button type="submit">Generate Custom Report</button>
    </form>
    <div id="salesReport">
      <!-- Sales report will be inserted here -->
    </div>
  </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.flash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>
  
  <script>
    $(document).ready(function() {
      $('#customReportForm').submit(function(event) {
        event.preventDefault();
        const startDate = $('#startDate').val();
        const endDate = $('#endDate').val();
        fetchReport('custom', { startDate, endDate });
      });
    });

    function fetchReport(type, data = {}) {
      let url = `/order/sales-report/${type}`;
      if (type === 'custom') {
        url = '/order/sales-report/custom';
      }

      $.ajax({
        url: url,
        method: type === 'custom' ? 'POST' : 'GET',
        data: type === 'custom' ? JSON.stringify(data) : null,
        contentType: 'application/json',
        success: function(response) {
          renderReport(response);
        },
        error: function(error) {
          console.error('Error fetching sales report:', error);
          alert('Failed to fetch sales report. Please try again.');
        }
      });
    }

   function renderReport(data) {
  let html = `
    <h2>${data.type} Sales Report</h2>
    <p>Total Sales: ₹${data.totalSales}</p>
    <p>Overall Order Count: ${data.orderCount}</p>
    <p>Overall Discount: ₹${data.totalDiscount}</p>
    <table id="ordersTable" class="display">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Total Price</th>
          <th>Discount</th>
          <th>Shipping Address</th>
          <th>Payment Method</th>
          <th>Status</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody>
        ${data.orders.map(order => `
          <tr>
            <td>${order.orderID}</td>
            <td>₹${order.totalPrice}</td>
            <td>₹${order.discountAmount}</td>
            <td>${order.shippingAddress}</td>
            <td>${order.paymentMethod}</td>
            <td>${order.status}</td>
            <td>${new Date(order.createdAt).toLocaleString()}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  $('#salesReport').html(html);
  
  // Initialize DataTable with buttons after rendering the report
  $('#ordersTable').DataTable({
    dom: 'Bfrtip',
    buttons: [
      'copy', 
      'csv', 
      'excel', 
      {
        extend: 'pdfHtml5',
        orientation: 'landscape',
        pageSize: 'A4',
        customize: function(doc) {
          // Add right margin
          doc.content[0].margin = [10, 10, 50, 10]; // [left, top, right, bottom]
        }
      },
      'print'
    ]
  });
}
  </script>
</body>
</html>
